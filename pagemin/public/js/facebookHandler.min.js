;
var facebookHandler=function(){
}
facebookHandler.login=function(){
$.mobile.loading("show");
$("#popupLogin").popup("close");
$("#popupRegister").popup("close");
setTimeout(function(){
$.mobile.loading("hide");
},20000)
FB.login(function(response){
if(!response.authResponse){
$.mobile.loading("hide");
}
},{scope:'public_profile, email'});
}
facebookHandler.logout=function(){
console.log("!!!!!! LOGOUT")
facebookHandler.logoutTimer=Date.now();
facebookHandler.logoutTimer=Date.now();
facebookHandler.loggedIn=false;
console.log("LOGOUT")

}

facebookHandler.authAndLoggedIn=function(response){
if(accountController.loggedIn&&!facebookHandler.loggedIn){
facebookHandler.loggedIn=true;
}else if(!facebookHandler.loggedIn){
var loginResponse=response;
$.mobile.loading("show");
$("#popupLogin").popup("close");
$("#popupRegister").popup("close");
FB.api('/me',function(response){
console.log(JSON.stringify(response));
if(!response.email||!response.id||!response.username||!loginResponse.authResponse.accessToken){

}else{
console.log("SocialSignIn")
console.log(JSON.stringify(loginResponse))
console.log(loginResponse.authResponse.accessToken)
accountController.socialSignIn(response.username,response.email,response.id,1,loginResponse.authResponse.accessToken)

}
});
}
}
facebookHandler.init=function(){
window.fbAsyncInit=function(){
FB.init({
appId:'467888830036802',
status:true,cookie:true,xfbml:true});
FB.Event.subscribe('auth.authResponseChange',function(response){
console.log("FB RESPONSE!!! "+response.status+"   "+facebookHandler.loggedIn+"    "+accountController.loggedIn)
if(response.status==='connected'){
facebookHandler.authAndLoggedIn(response);
}else if(response.status==='not_authorized'){

}else{

if(!facebookHandler.logoutTimer||Date.now()-facebookHandler.logoutTimer>2000){
console.log("AUTOLOGIN!!!!!"+(Date.now()-facebookHandler.logoutTimer)+"  "+facebookHandler.logoutTimer)
FB.login(function(response){
},{scope:'public_profile, email'});
}
}
});
};
(function(d){
var js,id='facebook-jssdk',ref=d.getElementsByTagName('script')[0];
if(d.getElementById(id)){
return;
}
js=d.createElement('script');
js.id=id;
js.async=true;
js.src="//connect.facebook.net/en_US/all.js";
ref.parentNode.insertBefore(js,ref);
}(document));
}

facebookHandler.updateSongFBButtons=function(){
if(playbackController.playingSong)
$("#fbartistbox").html(preloadhtml.sharefbartist.replace("songbase.fm","songbase.fm?artist="+mediaController.getSongArtist(playbackController.playingSong)));
else
$("#fbartistbox").html(preloadhtml.sharefbartist);
if(playbackController.playingSong)
$("#fbtitlebox").html(preloadhtml.sharefbsong.replace("songbase.fm","songbase.fm?play="+playbackController.getPlayingTitle()));
else
$("#fbtitlebox").html(preloadhtml.sharefbsong);
try{
FB.XFBML.parse($("#fbtitlebox").get(0));
FB.XFBML.parse($("#fbartistbox").get(0));
}catch(ex){
}
}
facebookHandler.postOnFacebook=function(){
if(playbackController.playingSong){
mediaController.sendRating("1");
var song=playbackController.getPlayingSong();
var fburl="http://www.songbase.fm?play="+playbackController.getPlayingTitle()+"&t="+playbackController.getPlayingTitle();
}
else{
fburl="http://www.songbase.fm&t=songbase.fm - All Your Music";
}
mywindow=window.open("http://www.facebook.com/sharer.php?u="+fburl,"","");
mywindow.focus();
}
;
