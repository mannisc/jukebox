;
var mediaelementPlayer=function(selector){

this.container=null;this.containerVideo=null;this.videoSelector=selector;
this.videoElement=$(selector);

this.init=function(){
var that=this;
MediaElementPlayer.prototype.extoptions={scale:1.5,displayBox:false};

this.mediaElementPlayer=new MediaElementPlayer(selector,{
features:['prevtrack','playpause','stop','nexttrack','shuffle','current','progress','duration','volume','fullscreen'],
pauseOtherPlayers:true,
enableKeyboard:false,
alwaysShowControls:true,
autosizeProgress:false,
success:function(mediaElement,domObject){
that.container=$(selector).parents(".mejs-container");
that.containerVideo=$(selector).parents(".mejs-mediaelement");
setTimeout(function(){
var oldSetProgressRail=that.mediaElementPlayer.setProgressRail;
that.mediaElementPlayer.setProgressRail=function(){
var percent=oldSetProgressRail();
var target=that.mediaElementPlayer.media;
if(target&&target.buffered&&target.buffered.length>0&&target.buffered.end&&target.duration){
var minDiff=target.duration;
var minDiffPos=0;
for(var i=0;i<target.buffered.length;i++){
var diff=target.buffered.end(i)-target.currentTime;
if(diff>=0&&diff<minDiff){
minDiff=diff;
minDiffPos=target.buffered.end(i);
}
}
percent=minDiffPos/target.duration;
}
else if(target&&target.bytesTotal!=undefined&&target.bytesTotal>0&&target.bufferedBytes!=undefined){
percent=target.bufferedBytes/target.bytesTotal;
}
if(percent!==null){
percent=Math.min(1,Math.max(0,percent));
videoController.setBufferedPercentage(percent)
}
}
},0);
var resizeLayer=$(".mejs-overlay-play").clone();
resizeLayer.removeClass("mejs-overlay-play").addClass("mejs-overlay-resize");
resizeLayer.insertAfter(".mejs-overlay-play");
that.container.find(".mejs-overlay-play").remove();
that.container.find(".mejs-overlay-resize").click(function(){
setTimeout(function(){
if(Date.now()-uiController.noVideoClickTimer>600){
videoController.playPauseSong();
}
},500)
})
that.container.find(".mejs-overlay-resize").dblclick(function(){
uiController.noVideoClickTimer=Date.now();
if(!uiController.isMaxVideoSizeFaktor(uiController.sizeVideo))
uiController.sizeVideo=uiController.sizeVideo*1.5;
else
uiController.sizeVideo=1/1.5;
uiController.styleVideo();
})
mediaElement.addEventListener("canplay",function(e){
that.mediaElementPlayer.media.setVolume(videoController.volume);
that.canplay=true;
if(that.startplay){
that.play();
}
else if(that.startplause)
that.pause();
that.startplause=false;
that.startplay=false;
that.startplay=false;
})
mediaElement.addEventListener("playing",function(e){
videoController.playingSong();
that.updateTime.call(that);
});
mediaElement.addEventListener("ended",function(e){
videoController.endedSong();
that.stopUpdateTime();
});
mediaElement.addEventListener("error",function(e){if(mediaController.currentvideoURL!=""){
if(!videoController.isEmbedVideo(mediaController.currentvideoURL)){
console.log("MEDIAELEMENT ERROR!")
mediaController.PlayingSongError();
}
}

});
mediaElement.addEventListener('loadeddata',function(e){
videoController.setMaxTime(mediaElement.duration)
});
},
error:function(){
console.log("Error creating mediaelementjs!");
}
});
};

this.load=function(url){
videoController.setProgressPercentage(0);
this.mediaElementPlayer.setSrc(url);
this.mediaElementPlayer.load();
this.containerVideo.addClass("backgroundVideo").appendTo("#backgroundVideo");
this.canplay=false;
this.startplay=false;
this.startplause=false;
console.log("LOAD"+Date.now())
}

this.unload=function(url){
this.stop();
this.stopUpdateTime();
this.containerVideo.addClass("backgroundVideo").insertAfter($(this.container).find(".mejs-inner"));
this.containerVideo.find("video").first().attr('src','')
}
this.updateTime=function(){
var that=this;
if(that.updateTimeTimeout){
clearTimeout(that.updateTimeTimeout)
that.updateTimeTimeout=null;
}
if(that.mediaElementPlayer){
videoController.setProgressTime(that.mediaElementPlayer.media.currentTime);
}
this.updateTimeTimeout=setTimeout(function(){
that.updateTime.call(that)
},100);
}
this.stopUpdateTime=function(){
if(this.updateTimeTimeout){
clearTimeout(this.updateTimeTimeout)
this.updateTimeTimeout=null;
}
}
this.play=function(){
if(this.canplay){
this.mediaElementPlayer.play();
}
else{
this.startplay=true;
this.startplause=false;
}
};
this.pause=function(){
if(this.canplay){
this.mediaElementPlayer.pause();
this.stopUpdateTime();
}else{
this.startplay=false;
this.startplause=true;
}
};
this.stop=function(){
this.container.find(".mejs-stop-button").click()};

this.setProgressPercentage=function(percentage){
if(!this.mediaElementPlayer.media)
return;
var newTime=percentage*this.mediaElementPlayer.media.duration;
if(newTime&&newTime!==this.mediaElementPlayer.media.currentTime){
this.mediaElementPlayer.media.setCurrentTime(newTime);
}
videoController.setProgressPercentage(percentage,false)
}
this.setVolume=function(volume){
if(this.mediaElementPlayer&&this.mediaElementPlayer.media)
this.mediaElementPlayer.media.setVolume(volume);
};
}

;
